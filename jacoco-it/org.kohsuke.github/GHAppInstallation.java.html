<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GHAppInstallation.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GitHub API for Java</a> &gt; <a href="index.source.html" class="el_package">org.kohsuke.github</a> &gt; <span class="el_source">GHAppInstallation.java</span></div><h1>GHAppInstallation.java</h1><pre class="source lang-java linenums">package org.kohsuke.github;

import com.fasterxml.jackson.annotation.JsonProperty;
import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
import org.kohsuke.github.internal.EnumUtils;

import java.io.IOException;
import java.net.URL;
import java.util.Collections;
import java.util.Date;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import static org.kohsuke.github.internal.Previews.GAMBIT;
import static org.kohsuke.github.internal.Previews.MACHINE_MAN;

// TODO: Auto-generated Javadoc
/**
 * A Github App Installation.
 *
 * @author Paulo Miguel Almeida
 * @see GHApp#listInstallations() GHApp#listInstallations()
 * @see GHApp#getInstallationById(long) GHApp#getInstallationById(long)
 * @see GHApp#getInstallationByOrganization(String) GHApp#getInstallationByOrganization(String)
 * @see GHApp#getInstallationByRepository(String, String) GHApp#getInstallationByRepository(String, String)
 * @see GHApp#getInstallationByUser(String) GHApp#getInstallationByUser(String)
 */
<span class="fc" id="L29">public class GHAppInstallation extends GHObject {</span>
    private GHUser account;

    @JsonProperty(&quot;access_tokens_url&quot;)
    private String accessTokenUrl;
    @JsonProperty(&quot;repositories_url&quot;)
    private String repositoriesUrl;
    @JsonProperty(&quot;app_id&quot;)
    private long appId;
    @JsonProperty(&quot;target_id&quot;)
    private long targetId;
    @JsonProperty(&quot;target_type&quot;)
    private GHTargetType targetType;
    private Map&lt;String, GHPermissionType&gt; permissions;
    private List&lt;String&gt; events;
    @JsonProperty(&quot;single_file_name&quot;)
    private String singleFileName;
    @JsonProperty(&quot;repository_selection&quot;)
    private GHRepositorySelection repositorySelection;
    private String htmlUrl;
    private String suspendedAt;
    private GHUser suspendedBy;

    /**
     * Gets the html url.
     *
     * @return the html url
     */
    public URL getHtmlUrl() {
<span class="nc" id="L58">        return GitHubClient.parseURL(htmlUrl);</span>
    }

    /**
     * Sets root.
     *
     * @param root
     *            the root
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setRoot(GitHub root) {
<span class="fc" id="L70">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets account.
     *
     * @return the account
     */
    @SuppressFBWarnings(value = { &quot;EI_EXPOSE_REP&quot; }, justification = &quot;Expected behavior&quot;)
    public GHUser getAccount() {
<span class="fc" id="L80">        return account;</span>
    }

    /**
     * Sets account.
     *
     * @param account
     *            the account
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setAccount(GHUser account) {
<span class="fc" id="L92">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets access token url.
     *
     * @return the access token url
     */
    public String getAccessTokenUrl() {
<span class="fc" id="L101">        return accessTokenUrl;</span>
    }

    /**
     * Sets access token url.
     *
     * @param accessTokenUrl
     *            the access token url
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setAccessTokenUrl(String accessTokenUrl) {
<span class="fc" id="L113">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets repositories url.
     *
     * @return the repositories url
     */
    public String getRepositoriesUrl() {
<span class="fc" id="L122">        return repositoriesUrl;</span>
    }

    /**
     * List repositories that this app installation can access.
     *
     * @return the paged iterable
     * @deprecated This method cannot work on a {@link GHAppInstallation} retrieved from
     *             {@link GHApp#listInstallations()} (for example), except when resorting to unsupported hacks involving
     *             {@link GHAppInstallation#setRoot(GitHub)} to switch from an application client to an installation
     *             client. This method will be removed. You should instead use an installation client (with an
     *             installation token, not a JWT), retrieve a {@link GHAuthenticatedAppInstallation} from
     *             {@link GitHub#getInstallation()}, then call
     *             {@link GHAuthenticatedAppInstallation#listRepositories()}.
     */
    @Deprecated
    @Preview(MACHINE_MAN)
    public PagedSearchIterable&lt;GHRepository&gt; listRepositories() {
        GitHubRequest request;

<span class="fc" id="L142">        request = root().createRequest().withPreview(MACHINE_MAN).withUrlPath(&quot;/installation/repositories&quot;).build();</span>

<span class="fc" id="L144">        return new PagedSearchIterable&lt;&gt;(root(), request, GHAppInstallationRepositoryResult.class);</span>
    }

    private static class GHAppInstallationRepositoryResult extends SearchResult&lt;GHRepository&gt; {
        private GHRepository[] repositories;

        @Override
        GHRepository[] getItems(GitHub root) {
<span class="fc" id="L152">            return repositories;</span>
        }
    }

    /**
     * Sets repositories url.
     *
     * @param repositoriesUrl
     *            the repositories url
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setRepositoriesUrl(String repositoriesUrl) {
<span class="fc" id="L165">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets app id.
     *
     * @return the app id
     */
    public long getAppId() {
<span class="fc" id="L174">        return appId;</span>
    }

    /**
     * Sets app id.
     *
     * @param appId
     *            the app id
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setAppId(long appId) {
<span class="fc" id="L186">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets target id.
     *
     * @return the target id
     */
    public long getTargetId() {
<span class="fc" id="L195">        return targetId;</span>
    }

    /**
     * Sets target id.
     *
     * @param targetId
     *            the target id
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setTargetId(long targetId) {
<span class="fc" id="L207">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets target type.
     *
     * @return the target type
     */
    public GHTargetType getTargetType() {
<span class="fc" id="L216">        return targetType;</span>
    }

    /**
     * Sets target type.
     *
     * @param targetType
     *            the target type
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setTargetType(GHTargetType targetType) {
<span class="fc" id="L228">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets permissions.
     *
     * @return the permissions
     */
    public Map&lt;String, GHPermissionType&gt; getPermissions() {
<span class="fc" id="L237">        return Collections.unmodifiableMap(permissions);</span>
    }

    /**
     * Sets permissions.
     *
     * @param permissions
     *            the permissions
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setPermissions(Map&lt;String, GHPermissionType&gt; permissions) {
<span class="fc" id="L249">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets events.
     *
     * @return the events
     */
    public List&lt;GHEvent&gt; getEvents() {
<span class="fc" id="L258">        return events.stream()</span>
<span class="fc" id="L259">                .map(e -&gt; EnumUtils.getEnumOrDefault(GHEvent.class, e, GHEvent.UNKNOWN))</span>
<span class="fc" id="L260">                .collect(Collectors.toList());</span>
    }

    /**
     * Sets events.
     *
     * @param events
     *            the events
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setEvents(List&lt;GHEvent&gt; events) {
<span class="fc" id="L272">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets single file name.
     *
     * @return the single file name
     */
    public String getSingleFileName() {
<span class="fc" id="L281">        return singleFileName;</span>
    }

    /**
     * Sets single file name.
     *
     * @param singleFileName
     *            the single file name
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setSingleFileName(String singleFileName) {
<span class="fc" id="L293">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets repository selection.
     *
     * @return the repository selection
     */
    public GHRepositorySelection getRepositorySelection() {
<span class="fc" id="L302">        return repositorySelection;</span>
    }

    /**
     * Sets repository selection.
     *
     * @param repositorySelection
     *            the repository selection
     * @deprecated Do not use this method. It was added due to incomplete understanding of Jackson binding.
     */
    @Deprecated
    public void setRepositorySelection(GHRepositorySelection repositorySelection) {
<span class="fc" id="L314">        throw new RuntimeException(&quot;Do not use this method.&quot;);</span>
    }

    /**
     * Gets suspended at.
     *
     * @return the suspended at
     */
    public Date getSuspendedAt() {
<span class="fc" id="L323">        return GitHubClient.parseDate(suspendedAt);</span>
    }

    /**
     * Gets suspended by.
     *
     * @return the suspended by
     */
    @SuppressFBWarnings(value = { &quot;EI_EXPOSE_REP&quot; }, justification = &quot;Expected behavior&quot;)
    public GHUser getSuspendedBy() {
<span class="fc" id="L333">        return suspendedBy;</span>
    }

    /**
     * Delete a Github App installation
     * &lt;p&gt;
     * You must use a JWT to access this endpoint.
     *
     * @throws IOException
     *             on error
     * @see &lt;a href=&quot;https://developer.github.com/v3/apps/#delete-an-installation&quot;&gt;Delete an installation&lt;/a&gt;
     */
    @Preview(GAMBIT)
    public void deleteInstallation() throws IOException {
<span class="fc" id="L347">        root().createRequest()</span>
<span class="fc" id="L348">                .method(&quot;DELETE&quot;)</span>
<span class="fc" id="L349">                .withPreview(GAMBIT)</span>
<span class="fc" id="L350">                .withUrlPath(String.format(&quot;/app/installations/%d&quot;, getId()))</span>
<span class="fc" id="L351">                .send();</span>
<span class="fc" id="L352">    }</span>

    /**
     * Starts a builder that creates a new App Installation Token.
     *
     * &lt;p&gt;
     * You use the returned builder to set various properties, then call {@link GHAppCreateTokenBuilder#create()} to
     * finally create an access token.
     *
     * @param permissions
     *            map of permissions for the created token
     * @return a GHAppCreateTokenBuilder instance
     * @deprecated Use {@link GHAppInstallation#createToken()} instead.
     */
    @BetaApi
    public GHAppCreateTokenBuilder createToken(Map&lt;String, GHPermissionType&gt; permissions) {
<span class="nc" id="L368">        return new GHAppCreateTokenBuilder(root(),</span>
<span class="nc" id="L369">                String.format(&quot;/app/installations/%d/access_tokens&quot;, getId()),</span>
                permissions);
    }

    /**
     * Starts a builder that creates a new App Installation Token.
     *
     * &lt;p&gt;
     * You use the returned builder to set various properties, then call {@link GHAppCreateTokenBuilder#create()} to
     * finally create an access token.
     *
     * @return a GHAppCreateTokenBuilder instance
     */
    @BetaApi
    public GHAppCreateTokenBuilder createToken() {
<span class="fc" id="L384">        return new GHAppCreateTokenBuilder(root(), String.format(&quot;/app/installations/%d/access_tokens&quot;, getId()));</span>
    }

    /**
     * Shows whether the user or organization account actively subscribes to a plan listed by the authenticated GitHub
     * App. When someone submits a plan change that won't be processed until the end of their billing cycle, you will
     * also see the upcoming pending change.
     *
     * &lt;p&gt;
     * GitHub Apps must use a JWT to access this endpoint.
     * &lt;p&gt;
     * OAuth Apps must use basic authentication with their client ID and client secret to access this endpoint.
     *
     * @return a GHMarketplaceAccountPlan instance
     * @throws IOException
     *             it may throw an {@link IOException}
     * @see &lt;a href=
     *      &quot;https://docs.github.com/en/rest/apps/marketplace?apiVersion=2022-11-28#get-a-subscription-plan-for-an-account&quot;&gt;Get
     *      a subscription plan for an account&lt;/a&gt;
     */
    public GHMarketplaceAccountPlan getMarketplaceAccount() throws IOException {
<span class="fc" id="L405">        return new GHMarketplacePlanForAccountBuilder(root(), account.getId()).createRequest();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>