<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GitHubResponse.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">GitHub API for Java</a> &gt; <a href="index.source.html" class="el_package">org.kohsuke.github</a> &gt; <span class="el_source">GitHubResponse.java</span></div><h1>GitHubResponse.java</h1><pre class="source lang-java linenums">package org.kohsuke.github;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.databind.InjectableValues;
import com.fasterxml.jackson.databind.JsonMappingException;
import org.apache.commons.io.IOUtils;
import org.kohsuke.github.connector.GitHubConnectorResponse;

import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.lang.reflect.Array;
import java.nio.charset.StandardCharsets;
import java.util.*;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.annotation.CheckForNull;
import javax.annotation.Nonnull;

import static java.net.HttpURLConnection.HTTP_NO_CONTENT;

// TODO: Auto-generated Javadoc
/**
 * A GitHubResponse
 * &lt;p&gt;
 * A {@link GitHubResponse} generated by sending a {@link GitHubRequest} to a {@link GitHubClient}.
 * &lt;/p&gt;
 *
 * @author Liam Newman
 * @param &lt;T&gt;
 *            the type of the data parsed from the body of a {@link GitHubConnectorResponse}.
 */
class GitHubResponse&lt;T&gt; {

<span class="fc" id="L36">    private static final Logger LOGGER = Logger.getLogger(GitHubResponse.class.getName());</span>

    private final int statusCode;

    @Nonnull
    private final Map&lt;String, List&lt;String&gt;&gt; headers;

    @CheckForNull
    private final T body;

    /**
     * Instantiates a new git hub response.
     *
     * @param response
     *            the response
     * @param body
     *            the body
     */
<span class="fc" id="L54">    GitHubResponse(GitHubResponse&lt;T&gt; response, @CheckForNull T body) {</span>
<span class="fc" id="L55">        this.statusCode = response.statusCode();</span>
<span class="fc" id="L56">        this.headers = response.headers;</span>
<span class="fc" id="L57">        this.body = body;</span>
<span class="fc" id="L58">    }</span>

    /**
     * Instantiates a new git hub response.
     *
     * @param connectorResponse
     *            the connector response
     * @param body
     *            the body
     */
<span class="fc" id="L68">    GitHubResponse(GitHubConnectorResponse connectorResponse, @CheckForNull T body) {</span>
<span class="fc" id="L69">        this.statusCode = connectorResponse.statusCode();</span>
<span class="fc" id="L70">        this.headers = connectorResponse.allHeaders();</span>
<span class="fc" id="L71">        this.body = body;</span>
<span class="fc" id="L72">    }</span>

    /**
     * Parses a {@link GitHubConnectorResponse} body into a new instance of {@code T}.
     *
     * @param &lt;T&gt;
     *            the type
     * @param connectorResponse
     *            response info to parse.
     * @param type
     *            the type to be constructed.
     * @return a new instance of {@code T}.
     * @throws IOException
     *             if there is an I/O Exception.
     */
    @CheckForNull
    static &lt;T&gt; T parseBody(GitHubConnectorResponse connectorResponse, Class&lt;T&gt; type) throws IOException {

<span class="fc bfc" id="L90" title="All 2 branches covered.">        if (connectorResponse.statusCode() == HTTP_NO_CONTENT) {</span>
<span class="pc bpc" id="L91" title="1 of 4 branches missed.">            if (type != null &amp;&amp; type.isArray()) {</span>
                // no content for array should be empty array
<span class="fc" id="L93">                return type.cast(Array.newInstance(type.getComponentType(), 0));</span>
            } else {
                // no content for object should be null
<span class="fc" id="L96">                return null;</span>
            }
        }

<span class="fc" id="L100">        String data = getBodyAsString(connectorResponse);</span>
        try {
<span class="fc" id="L102">            InjectableValues.Std inject = new InjectableValues.Std();</span>
<span class="fc" id="L103">            inject.addValue(GitHubConnectorResponse.class, connectorResponse);</span>

<span class="fc" id="L105">            return GitHubClient.getMappingObjectReader(connectorResponse).forType(type).readValue(data);</span>
<span class="fc" id="L106">        } catch (JsonMappingException | JsonParseException e) {</span>
<span class="fc" id="L107">            String message = &quot;Failed to deserialize: &quot; + data;</span>
<span class="fc" id="L108">            LOGGER.log(Level.FINE, message);</span>
<span class="fc" id="L109">            throw e;</span>
        }
    }

    /**
     * Parses a {@link GitHubConnectorResponse} body into a new instance of {@code T}.
     *
     * @param &lt;T&gt;
     *            the type
     * @param connectorResponse
     *            response info to parse.
     * @param instance
     *            the object to fill with data parsed from body
     * @return a new instance of {@code T}.
     * @throws IOException
     *             if there is an I/O Exception.
     */
    @CheckForNull
    static &lt;T&gt; T parseBody(GitHubConnectorResponse connectorResponse, T instance) throws IOException {

<span class="fc" id="L129">        String data = getBodyAsString(connectorResponse);</span>
        try {
<span class="fc" id="L131">            return GitHubClient.getMappingObjectReader(connectorResponse).withValueToUpdate(instance).readValue(data);</span>
<span class="nc" id="L132">        } catch (JsonMappingException | JsonParseException e) {</span>
<span class="nc" id="L133">            String message = &quot;Failed to deserialize: &quot; + data;</span>
<span class="nc" id="L134">            LOGGER.log(Level.FINE, message);</span>
<span class="nc" id="L135">            throw e;</span>
        }
    }

    /**
     * Gets the body of the response as a {@link String}.
     *
     * @param connectorResponse
     *            the response to read
     * @return the body of the response as a {@link String}.
     * @throws IOException
     *             if an I/O Exception occurs.
     */
    @Nonnull
    static String getBodyAsString(GitHubConnectorResponse connectorResponse) throws IOException {
<span class="fc" id="L150">        InputStream inputStream = connectorResponse.bodyStream();</span>
<span class="fc" id="L151">        try (InputStreamReader r = new InputStreamReader(inputStream, StandardCharsets.UTF_8)) {</span>
<span class="fc" id="L152">            return IOUtils.toString(r);</span>
        }
    }

    /**
     * Gets the body of the response as a {@link String}.
     *
     * @param connectorResponse
     *            the response to read
     * @return the body of the response as a {@link String}.
     */
    static String getBodyAsStringOrNull(GitHubConnectorResponse connectorResponse) {
        try {
<span class="fc" id="L165">            return getBodyAsString(connectorResponse);</span>
<span class="nc" id="L166">        } catch (IOException e) {</span>
        }
<span class="nc" id="L168">        return null;</span>
    }

    /**
     * The status code for this response.
     *
     * @return the status code for this response.
     */
    public int statusCode() {
<span class="fc" id="L177">        return statusCode;</span>
    }

    /**
     * The headers for this response.
     *
     * @param field
     *            the field
     * @return the headers for this response.
     */
    @Nonnull
    public List&lt;String&gt; headers(String field) {
<span class="nc" id="L189">        return headers.get(field);</span>
    }

    /**
     * Gets the value of a header field for this response.
     *
     * @param name
     *            the name of the header field.
     * @return the value of the header field, or {@code null} if the header isn't set.
     */
    @CheckForNull
    public String header(String name) {
<span class="fc" id="L201">        String result = null;</span>
<span class="fc" id="L202">        List&lt;String&gt; rawResult = headers.get(name);</span>
<span class="fc bfc" id="L203" title="All 2 branches covered.">        if (rawResult != null) {</span>
<span class="fc" id="L204">            result = rawResult.get(0);</span>
        }
<span class="fc" id="L206">        return result;</span>
    }

    /**
     * The body of the response parsed as a {@code T}.
     *
     * @return body of the response
     */
    public T body() {
<span class="fc" id="L215">        return body;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>